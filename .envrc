# Configuration direnv pour Pexiora TT
source_up_if_exists
watch_file package.json
watch_file lefthook.yml

# --- D√©pendances js (pnpm/Bun) & Configuration de l'environnement ---

# V√©rifier la pr√©sence de pnpm (requis pour l'installation)
if ! command -v pnpm &> /dev/null; then
    echo "‚ùå pnpm n'est pas install√©. Installez-le avec:"
    echo "   - brew install pnpm"
    return 1
fi

# V√©rifier la pr√©sence de Bun (ex√©cuteur rapide)
if ! command -v bun &> /dev/null; then
    echo "‚ùå Bun n'est pas install√©. Installez-le avec :"
    echo "   - brew install oven-sh/bun/bun"
    echo "   Puis red√©marrez votre shell"
    return 1
fi

# V√©rification et installation des d√©pendances js avec pnpm
if [ -f "package.json" ]; then
    echo "V√©rification et installation des d√©pendances avec pnpm..."
    pnpm install --silent
    # Installer les hooks lefthook
    if command -v bun &> /dev/null; then
        echo "Installation des hooks lefthook..."
        bun run prepare 2>/dev/null || lefthook install
    fi
fi

# --- V√©rifications des Outils Syst√®mes (Zola, etc.) ---

# V√©rifier la pr√©sence de Zola
if ! command -v zola &> /dev/null; then
# ... (Instructions d'installation Zola)
    echo "‚ùå Zola n'est pas install√©."
    echo "üìñ Consultez la documentation d'installation :"
    echo "   https://www.getzola.org/documentation/getting-started/installation/"
    echo ""
    echo "üöÄ Installation rapide :"
    echo "   - brew install zola"
    echo ""
    return 1
fi

# V√©rifier la pr√©sence de just
if ! command -v just &> /dev/null; then
# ... (Instructions d'installation Just)
    echo "‚ùå just n'est pas install√©. Installez-le avec:"
    echo "   - cargo install just (si vous avez Rust install√©)"
    echo "   - brew install just"
    echo "   Puis red√©marrez votre shell"
    return 1
fi

# V√©rifier la pr√©sence de bats
if ! command -v bats &> /dev/null; then
# ... (Instructions d'installation BATS)
    echo "‚ùå bats n'est pas install√©. Installez-le avec:"
    echo "   - brew install bats-core"
    echo "   Puis red√©marrez votre shell"
    return 1
fi

# --- Finalisation et Messages ---

echo "‚úÖ Environnement Pexiora TT pr√™t !"
echo "üí° Commandes disponibles :"
echo "   just dev    - D√©marrer le serveur de d√©veloppement"
echo "   just build  - Construire le site"
echo "   just check  - V√©rifier la qualit√© du code"
echo "   just test   - Lancer les tests"

# V√©rifier les versions
echo ""
echo "üîß Versions install√©es :"
echo "   Zola: $(zola --version)"
echo "   pnpm: $(pnpm --version 2>/dev/null || echo "Non install√©")"
echo "   Netlify CLI: $(pnpm exec netlify --version 2>/dev/null || echo "Non install√©")"
echo "   Bun: $(bun --version 2>/dev/null || echo "Non install√©")"
echo "   Just: $(just --version 2>/dev/null || echo "Non install√©")"
